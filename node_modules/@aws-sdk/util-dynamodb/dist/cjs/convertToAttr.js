"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.convertToAttr = void 0;
const convertToAttr = (data, options) => {
    var _a, _b, _c, _d, _e, _f;
    if (data === undefined) {
        throw new Error(`Pass options.removeUndefinedValues=true to remove undefined values from map/array/set.`);
    }
    else if (data === null && typeof data === "object") {
        return convertToNullAttr();
    }
    else if (Array.isArray(data)) {
        return convertToListAttr(data, options);
    }
    else if (((_a = data === null || data === void 0 ? void 0 : data.constructor) === null || _a === void 0 ? void 0 : _a.name) === "Set") {
        return convertToSetAttr(data, options);
    }
    else if (((_b = data === null || data === void 0 ? void 0 : data.constructor) === null || _b === void 0 ? void 0 : _b.name) === "Map") {
        return convertToMapAttrFromIterable(data, options);
    }
    else if (((_c = data === null || data === void 0 ? void 0 : data.constructor) === null || _c === void 0 ? void 0 : _c.name) === "Object" ||
        (!data.constructor && typeof data === "object")) {
        return convertToMapAttrFromEnumerableProps(data, options);
    }
    else if (isBinary(data)) {
        if (data.length === 0 && (options === null || options === void 0 ? void 0 : options.convertEmptyValues)) {
            return convertToNullAttr();
        }
        return convertToBinaryAttr(data);
    }
    else if (typeof data === "boolean" || ((_d = data === null || data === void 0 ? void 0 : data.constructor) === null || _d === void 0 ? void 0 : _d.name) === "Boolean") {
        return { BOOL: data.valueOf() };
    }
    else if (typeof data === "number" || ((_e = data === null || data === void 0 ? void 0 : data.constructor) === null || _e === void 0 ? void 0 : _e.name) === "Number") {
        return convertToNumberAttr(data);
    }
    else if (typeof data === "bigint") {
        return convertToBigIntAttr(data);
    }
    else if (typeof data === "string" || ((_f = data === null || data === void 0 ? void 0 : data.constructor) === null || _f === void 0 ? void 0 : _f.name) === "String") {
        if (data.length === 0 && (options === null || options === void 0 ? void 0 : options.convertEmptyValues)) {
            return convertToNullAttr();
        }
        return convertToStringAttr(data);
    }
    else if ((options === null || options === void 0 ? void 0 : options.convertClassInstanceToMap) && typeof data === "object") {
        return convertToMapAttrFromEnumerableProps(data, options);
    }
    throw new Error(`Unsupported type passed: ${data}. Pass options.convertClassInstanceToMap=true to marshall typeof object as map attribute.`);
};
exports.convertToAttr = convertToAttr;
const convertToListAttr = (data, options) => ({
    L: data
        .filter((item) => !(options === null || options === void 0 ? void 0 : options.removeUndefinedValues) || ((options === null || options === void 0 ? void 0 : options.removeUndefinedValues) && item !== undefined))
        .map((item) => exports.convertToAttr(item, options)),
});
const convertToSetAttr = (set, options) => {
    const setToOperate = (options === null || options === void 0 ? void 0 : options.removeUndefinedValues) ? new Set([...set].filter((value) => value !== undefined)) : set;
    if (!(options === null || options === void 0 ? void 0 : options.removeUndefinedValues) && setToOperate.has(undefined)) {
        throw new Error(`Pass options.removeUndefinedValues=true to remove undefined values from map/array/set.`);
    }
    if (setToOperate.size === 0) {
        if (options === null || options === void 0 ? void 0 : options.convertEmptyValues) {
            return convertToNullAttr();
        }
        throw new Error(`Pass a non-empty set, or options.convertEmptyValues=true.`);
    }
    const item = setToOperate.values().next().value;
    if (typeof item === "number") {
        return {
            NS: Array.from(setToOperate)
                .map(convertToNumberAttr)
                .map((item) => item.N),
        };
    }
    else if (typeof item === "bigint") {
        return {
            NS: Array.from(setToOperate)
                .map(convertToBigIntAttr)
                .map((item) => item.N),
        };
    }
    else if (typeof item === "string") {
        return {
            SS: Array.from(setToOperate)
                .map(convertToStringAttr)
                .map((item) => item.S),
        };
    }
    else if (isBinary(item)) {
        return {
            BS: Array.from(setToOperate)
                .map(convertToBinaryAttr)
                .map((item) => item.B),
        };
    }
    else {
        throw new Error(`Only Number Set (NS), Binary Set (BS) or String Set (SS) are allowed.`);
    }
};
const convertToMapAttrFromIterable = (data, options) => ({
    M: ((data) => {
        const map = {};
        for (const [key, value] of data) {
            if (typeof value !== "function" && (value !== undefined || !(options === null || options === void 0 ? void 0 : options.removeUndefinedValues))) {
                map[key] = exports.convertToAttr(value, options);
            }
        }
        return map;
    })(data),
});
const convertToMapAttrFromEnumerableProps = (data, options) => ({
    M: ((data) => {
        const map = {};
        for (const key in data) {
            const value = data[key];
            if (typeof value !== "function" && (value !== undefined || !(options === null || options === void 0 ? void 0 : options.removeUndefinedValues))) {
                map[key] = exports.convertToAttr(value, options);
            }
        }
        return map;
    })(data),
});
const convertToNullAttr = () => ({ NULL: true });
const convertToBinaryAttr = (data) => ({ B: data });
const convertToStringAttr = (data) => ({ S: data.toString() });
const convertToBigIntAttr = (data) => ({ N: data.toString() });
const validateBigIntAndThrow = (errorPrefix) => {
    throw new Error(`${errorPrefix} ${typeof BigInt === "function" ? "Use BigInt." : "Pass string value instead."} `);
};
const convertToNumberAttr = (num) => {
    if ([Number.NaN, Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY]
        .map((val) => val.toString())
        .includes(num.toString())) {
        throw new Error(`Special numeric value ${num.toString()} is not allowed`);
    }
    else if (num > Number.MAX_SAFE_INTEGER) {
        validateBigIntAndThrow(`Number ${num.toString()} is greater than Number.MAX_SAFE_INTEGER.`);
    }
    else if (num < Number.MIN_SAFE_INTEGER) {
        validateBigIntAndThrow(`Number ${num.toString()} is lesser than Number.MIN_SAFE_INTEGER.`);
    }
    return { N: num.toString() };
};
const isBinary = (data) => {
    const binaryTypes = [
        "ArrayBuffer",
        "Blob",
        "Buffer",
        "DataView",
        "File",
        "Int8Array",
        "Uint8Array",
        "Uint8ClampedArray",
        "Int16Array",
        "Uint16Array",
        "Int32Array",
        "Uint32Array",
        "Float32Array",
        "Float64Array",
        "BigInt64Array",
        "BigUint64Array",
    ];
    if (data === null || data === void 0 ? void 0 : data.constructor) {
        return binaryTypes.includes(data.constructor.name);
    }
    return false;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydFRvQXR0ci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb252ZXJ0VG9BdHRyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQVdPLE1BQU0sYUFBYSxHQUFHLENBQUMsSUFBMEIsRUFBRSxPQUF5QixFQUFrQixFQUFFOztJQUNyRyxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUU7UUFDdEIsTUFBTSxJQUFJLEtBQUssQ0FBQyx3RkFBd0YsQ0FBQyxDQUFDO0tBQzNHO1NBQU0sSUFBSSxJQUFJLEtBQUssSUFBSSxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRTtRQUNwRCxPQUFPLGlCQUFpQixFQUFFLENBQUM7S0FDNUI7U0FBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDOUIsT0FBTyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7S0FDekM7U0FBTSxJQUFJLENBQUEsTUFBQSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsV0FBVywwQ0FBRSxJQUFJLE1BQUssS0FBSyxFQUFFO1FBQzVDLE9BQU8sZ0JBQWdCLENBQUMsSUFBZ0IsRUFBRSxPQUFPLENBQUMsQ0FBQztLQUNwRDtTQUFNLElBQUksQ0FBQSxNQUFBLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxXQUFXLDBDQUFFLElBQUksTUFBSyxLQUFLLEVBQUU7UUFDNUMsT0FBTyw0QkFBNEIsQ0FBQyxJQUF5QyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0tBQ3pGO1NBQU0sSUFDTCxDQUFBLE1BQUEsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLFdBQVcsMENBQUUsSUFBSSxNQUFLLFFBQVE7UUFFcEMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksT0FBTyxJQUFJLEtBQUssUUFBUSxDQUFDLEVBQy9DO1FBQ0EsT0FBTyxtQ0FBbUMsQ0FBQyxJQUErQyxFQUFFLE9BQU8s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LFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUNwRDtJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXR0cmlidXRlVmFsdWUgfSBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LWR5bmFtb2RiXCI7XG5cbmltcG9ydCB7IG1hcnNoYWxsT3B0aW9ucyB9IGZyb20gXCIuL21hcnNoYWxsXCI7XG5pbXBvcnQgeyBOYXRpdmVBdHRyaWJ1dGVCaW5hcnksIE5hdGl2ZUF0dHJpYnV0ZVZhbHVlLCBOYXRpdmVTY2FsYXJBdHRyaWJ1dGVWYWx1ZSB9IGZyb20gXCIuL21vZGVsc1wiO1xuXG4vKipcbiAqIENvbnZlcnQgYSBKYXZhU2NyaXB0IHZhbHVlIHRvIGl0cyBlcXVpdmFsZW50IER5bmFtb0RCIEF0dHJpYnV0ZVZhbHVlIHR5cGVcbiAqXG4gKiBAcGFyYW0ge05hdGl2ZUF0dHJpYnV0ZVZhbHVlfSBkYXRhIC0gVGhlIGRhdGEgdG8gY29udmVydCB0byBhIER5bmFtb0RCIEF0dHJpYnV0ZVZhbHVlXG4gKiBAcGFyYW0ge21hcnNoYWxsT3B0aW9uc30gb3B0aW9ucyAtIEFuIG9wdGlvbmFsIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciBgY29udmVydFRvQXR0cmBcbiAqL1xuZXhwb3J0IGNvbnN0IGNvbnZlcnRUb0F0dHIgPSAoZGF0YTogTmF0aXZlQXR0cmlidXRlVmFsdWUsIG9wdGlvbnM/OiBtYXJzaGFsbE9wdGlvbnMpOiBBdHRyaWJ1dGVWYWx1ZSA9PiB7XG4gIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFBhc3Mgb3B0aW9ucy5yZW1vdmVVbmRlZmluZWRWYWx1ZXM9dHJ1ZSB0byByZW1vdmUgdW5kZWZpbmVkIHZhbHVlcyBmcm9tIG1hcC9hcnJheS9zZXQuYCk7XG4gIH0gZWxzZSBpZiAoZGF0YSA9PT0gbnVsbCAmJiB0eXBlb2YgZGF0YSA9PT0gXCJvYmplY3RcIikge1xuICAgIHJldHVybiBjb252ZXJ0VG9OdWxsQXR0cigpO1xuICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcbiAgICByZXR1cm4gY29udmVydFRvTGlzdEF0dHIoZGF0YSwgb3B0aW9ucyk7XG4gIH0gZWxzZSBpZiAoZGF0YT8uY29uc3RydWN0b3I/Lm5hbWUgPT09IFwiU2V0XCIpIHtcbiAgICByZXR1cm4gY29udmVydFRvU2V0QXR0cihkYXRhIGFzIFNldDxhbnk+LCBvcHRpb25zKTtcbiAgfSBlbHNlIGlmIChkYXRhPy5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gXCJNYXBcIikge1xuICAgIHJldHVybiBjb252ZXJ0VG9NYXBBdHRyRnJvbUl0ZXJhYmxlKGRhdGEgYXMgTWFwPHN0cmluZywgTmF0aXZlQXR0cmlidXRlVmFsdWU+LCBvcHRpb25zKTtcbiAgfSBlbHNlIGlmIChcbiAgICBkYXRhPy5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gXCJPYmplY3RcIiB8fFxuICAgIC8vIGZvciBvYmplY3Qgd2hpY2ggaXMgcmVzdWx0IG9mIE9iamVjdC5jcmVhdGUobnVsbCksIHdoaWNoIGRvZXNuJ3QgaGF2ZSBjb25zdHJ1Y3RvciBkZWZpbmVkXG4gICAgKCFkYXRhLmNvbnN0cnVjdG9yICYmIHR5cGVvZiBkYXRhID09PSBcIm9iamVjdFwiKVxuICApIHtcbiAgICByZXR1cm4gY29udmVydFRvTWFwQXR0ckZyb21FbnVtZXJhYmxlUHJvcHMoZGF0YSBhcyB7IFtrZXk6IHN0cmluZ106IE5hdGl2ZUF0dHJpYnV0ZVZhbHVlIH0sIG9wdGlvbnMpO1xuICB9IGVsc2UgaWYgKGlzQmluYXJ5KGRhdGEpKSB7XG4gICAgaWYgKGRhdGEubGVuZ3RoID09PSAwICYmIG9wdGlvbnM/LmNvbnZlcnRFbXB0eVZhbHVlcykge1xuICAgICAgcmV0dXJuIGNvbnZlcnRUb051bGxBdHRyKCk7XG4gICAgfVxuICAgIC8vIERvIG5vdCBhbHRlciBiaW5hcnkgZGF0YSBwYXNzZWQgaHR0cHM6Ly9naXRodWIuY29tL2F3cy9hd3Mtc2RrLWpzLXYzL2lzc3Vlcy8xNTMwXG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUeXBlICd7IEI6IE5hdGl2ZUF0dHJpYnV0ZUJpbmFyeTsgfScgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZSAnQXR0cmlidXRlVmFsdWUnXG4gICAgcmV0dXJuIGNvbnZlcnRUb0JpbmFyeUF0dHIoZGF0YSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09IFwiYm9vbGVhblwiIHx8IGRhdGE/LmNvbnN0cnVjdG9yPy5uYW1lID09PSBcIkJvb2xlYW5cIikge1xuICAgIHJldHVybiB7IEJPT0w6IGRhdGEudmFsdWVPZigpIH07XG4gIH0gZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09IFwibnVtYmVyXCIgfHwgZGF0YT8uY29uc3RydWN0b3I/Lm5hbWUgPT09IFwiTnVtYmVyXCIpIHtcbiAgICByZXR1cm4gY29udmVydFRvTnVtYmVyQXR0cihkYXRhKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZGF0YSA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBjb252ZXJ0VG9CaWdJbnRBdHRyKGRhdGEpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiIHx8IGRhdGE/LmNvbnN0cnVjdG9yPy5uYW1lID09PSBcIlN0cmluZ1wiKSB7XG4gICAgaWYgKGRhdGEubGVuZ3RoID09PSAwICYmIG9wdGlvbnM/LmNvbnZlcnRFbXB0eVZhbHVlcykge1xuICAgICAgcmV0dXJuIGNvbnZlcnRUb051bGxBdHRyKCk7XG4gICAgfVxuICAgIHJldHVybiBjb252ZXJ0VG9TdHJpbmdBdHRyKGRhdGEpO1xuICB9IGVsc2UgaWYgKG9wdGlvbnM/LmNvbnZlcnRDbGFzc0luc3RhbmNlVG9NYXAgJiYgdHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIpIHtcbiAgICByZXR1cm4gY29udmVydFRvTWFwQXR0ckZyb21FbnVtZXJhYmxlUHJvcHMoZGF0YSBhcyB7IFtrZXk6IHN0cmluZ106IE5hdGl2ZUF0dHJpYnV0ZVZhbHVlIH0sIG9wdGlvbnMpO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihcbiAgICBgVW5zdXBwb3J0ZWQgdHlwZSBwYXNzZWQ6ICR7ZGF0YX0uIFBhc3Mgb3B0aW9ucy5jb252ZXJ0Q2xhc3NJbnN0YW5jZVRvTWFwPXRydWUgdG8gbWFyc2hhbGwgdHlwZW9mIG9iamVjdCBhcyBtYXAgYXR0cmlidXRlLmBcbiAgKTtcbn07XG5cbmNvbnN0IGNvbnZlcnRUb0xpc3RBdHRyID0gKGRhdGE6IE5hdGl2ZUF0dHJpYnV0ZVZhbHVlW10sIG9wdGlvbnM/OiBtYXJzaGFsbE9wdGlvbnMpOiB7IEw6IEF0dHJpYnV0ZVZhbHVlW10gfSA9PiAoe1xuICBMOiBkYXRhXG4gICAgLmZpbHRlcigoaXRlbSkgPT4gIW9wdGlvbnM/LnJlbW92ZVVuZGVmaW5lZFZhbHVlcyB8fCAob3B0aW9ucz8ucmVtb3ZlVW5kZWZpbmVkVmFsdWVzICYmIGl0ZW0gIT09IHVuZGVmaW5lZCkpXG4gICAgLm1hcCgoaXRlbSkgPT4gY29udmVydFRvQXR0cihpdGVtLCBvcHRpb25zKSksXG59KTtcblxuY29uc3QgY29udmVydFRvU2V0QXR0ciA9IChcbiAgc2V0OiBTZXQ8YW55PixcbiAgb3B0aW9ucz86IG1hcnNoYWxsT3B0aW9uc1xuKTogeyBOUzogc3RyaW5nW10gfSB8IHsgQlM6IFVpbnQ4QXJyYXlbXSB9IHwgeyBTUzogc3RyaW5nW10gfSB8IHsgTlVMTDogdHJ1ZSB9ID0+IHtcbiAgY29uc3Qgc2V0VG9PcGVyYXRlID0gb3B0aW9ucz8ucmVtb3ZlVW5kZWZpbmVkVmFsdWVzID8gbmV3IFNldChbLi4uc2V0XS5maWx0ZXIoKHZhbHVlKSA9PiB2YWx1ZSAhPT0gdW5kZWZpbmVkKSkgOiBzZXQ7XG5cbiAgaWYgKCFvcHRpb25zPy5yZW1vdmVVbmRlZmluZWRWYWx1ZXMgJiYgc2V0VG9PcGVyYXRlLmhhcyh1bmRlZmluZWQpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBQYXNzIG9wdGlvbnMucmVtb3ZlVW5kZWZpbmVkVmFsdWVzPXRydWUgdG8gcmVtb3ZlIHVuZGVmaW5lZCB2YWx1ZXMgZnJvbSBtYXAvYXJyYXkvc2V0LmApO1xuICB9XG5cbiAgaWYgKHNldFRvT3BlcmF0ZS5zaXplID09PSAwKSB7XG4gICAgaWYgKG9wdGlvbnM/LmNvbnZlcnRFbXB0eVZhbHVlcykge1xuICAgICAgcmV0dXJuIGNvbnZlcnRUb051bGxBdHRyKCk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgUGFzcyBhIG5vbi1lbXB0eSBzZXQsIG9yIG9wdGlvbnMuY29udmVydEVtcHR5VmFsdWVzPXRydWUuYCk7XG4gIH1cblxuICBjb25zdCBpdGVtID0gc2V0VG9PcGVyYXRlLnZhbHVlcygpLm5leHQoKS52YWx1ZTtcbiAgaWYgKHR5cGVvZiBpdGVtID09PSBcIm51bWJlclwiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIE5TOiBBcnJheS5mcm9tKHNldFRvT3BlcmF0ZSlcbiAgICAgICAgLm1hcChjb252ZXJ0VG9OdW1iZXJBdHRyKVxuICAgICAgICAubWFwKChpdGVtKSA9PiBpdGVtLk4pLFxuICAgIH07XG4gIH0gZWxzZSBpZiAodHlwZW9mIGl0ZW0gPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgTlM6IEFycmF5LmZyb20oc2V0VG9PcGVyYXRlKVxuICAgICAgICAubWFwKGNvbnZlcnRUb0JpZ0ludEF0dHIpXG4gICAgICAgIC5tYXAoKGl0ZW0pID0+IGl0ZW0uTiksXG4gICAgfTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgaXRlbSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB7XG4gICAgICBTUzogQXJyYXkuZnJvbShzZXRUb09wZXJhdGUpXG4gICAgICAgIC5tYXAoY29udmVydFRvU3RyaW5nQXR0cilcbiAgICAgICAgLm1hcCgoaXRlbSkgPT4gaXRlbS5TKSxcbiAgICB9O1xuICB9IGVsc2UgaWYgKGlzQmluYXJ5KGl0ZW0pKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIERvIG5vdCBhbHRlciBiaW5hcnkgZGF0YSBwYXNzZWQgaHR0cHM6Ly9naXRodWIuY29tL2F3cy9hd3Mtc2RrLWpzLXYzL2lzc3Vlcy8xNTMwXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFR5cGUgJ0FycmF5QnVmZmVyJyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlICdVaW50OEFycmF5J1xuICAgICAgQlM6IEFycmF5LmZyb20oc2V0VG9PcGVyYXRlKVxuICAgICAgICAubWFwKGNvbnZlcnRUb0JpbmFyeUF0dHIpXG4gICAgICAgIC5tYXAoKGl0ZW0pID0+IGl0ZW0uQiksXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE9ubHkgTnVtYmVyIFNldCAoTlMpLCBCaW5hcnkgU2V0IChCUykgb3IgU3RyaW5nIFNldCAoU1MpIGFyZSBhbGxvd2VkLmApO1xuICB9XG59O1xuXG5jb25zdCBjb252ZXJ0VG9NYXBBdHRyRnJvbUl0ZXJhYmxlID0gKFxuICBkYXRhOiBNYXA8c3RyaW5nLCBOYXRpdmVBdHRyaWJ1dGVWYWx1ZT4sXG4gIG9wdGlvbnM/OiBtYXJzaGFsbE9wdGlvbnNcbik6IHsgTTogeyBba2V5OiBzdHJpbmddOiBBdHRyaWJ1dGVWYWx1ZSB9IH0gPT4gKHtcbiAgTTogKChkYXRhKSA9PiB7XG4gICAgY29uc3QgbWFwOiB7IFtrZXk6IHN0cmluZ106IEF0dHJpYnV0ZVZhbHVlIH0gPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBkYXRhKSB7XG4gICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcImZ1bmN0aW9uXCIgJiYgKHZhbHVlICE9PSB1bmRlZmluZWQgfHwgIW9wdGlvbnM/LnJlbW92ZVVuZGVmaW5lZFZhbHVlcykpIHtcbiAgICAgICAgbWFwW2tleV0gPSBjb252ZXJ0VG9BdHRyKHZhbHVlLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1hcDtcbiAgfSkoZGF0YSksXG59KTtcblxuY29uc3QgY29udmVydFRvTWFwQXR0ckZyb21FbnVtZXJhYmxlUHJvcHMgPSAoXG4gIGRhdGE6IHsgW2tleTogc3RyaW5nXTogTmF0aXZlQXR0cmlidXRlVmFsdWUgfSxcbiAgb3B0aW9ucz86IG1hcnNoYWxsT3B0aW9uc1xuKTogeyBNOiB7IFtrZXk6IHN0cmluZ106IEF0dHJpYnV0ZVZhbHVlIH0gfSA9PiAoe1xuICBNOiAoKGRhdGEpID0+IHtcbiAgICBjb25zdCBtYXA6IHsgW2tleTogc3RyaW5nXTogQXR0cmlidXRlVmFsdWUgfSA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gZGF0YVtrZXldO1xuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJmdW5jdGlvblwiICYmICh2YWx1ZSAhPT0gdW5kZWZpbmVkIHx8ICFvcHRpb25zPy5yZW1vdmVVbmRlZmluZWRWYWx1ZXMpKSB7XG4gICAgICAgIG1hcFtrZXldID0gY29udmVydFRvQXR0cih2YWx1ZSwgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBtYXA7XG4gIH0pKGRhdGEpLFxufSk7XG5cbi8vIEZvciBmdXR1cmUtcHJvb2Zpbmc6IHRoaXMgZnVuY3Rpb25zIGFyZSBjYWxsZWQgZnJvbSBtdWx0aXBsZSBwbGFjZXNcbmNvbnN0IGNvbnZlcnRUb051bGxBdHRyID0gKCk6IHsgTlVMTDogdHJ1ZSB9ID0+ICh7IE5VTEw6IHRydWUgfSk7XG5jb25zdCBjb252ZXJ0VG9CaW5hcnlBdHRyID0gKGRhdGE6IE5hdGl2ZUF0dHJpYnV0ZUJpbmFyeSk6IHsgQjogTmF0aXZlQXR0cmlidXRlQmluYXJ5IH0gPT4gKHsgQjogZGF0YSB9KTtcbmNvbnN0IGNvbnZlcnRUb1N0cmluZ0F0dHIgPSAoZGF0YTogc3RyaW5nIHwgU3RyaW5nKTogeyBTOiBzdHJpbmcgfSA9PiAoeyBTOiBkYXRhLnRvU3RyaW5nKCkgfSk7XG5jb25zdCBjb252ZXJ0VG9CaWdJbnRBdHRyID0gKGRhdGE6IGJpZ2ludCk6IHsgTjogc3RyaW5nIH0gPT4gKHsgTjogZGF0YS50b1N0cmluZygpIH0pO1xuXG5jb25zdCB2YWxpZGF0ZUJpZ0ludEFuZFRocm93ID0gKGVycm9yUHJlZml4OiBzdHJpbmcpID0+IHtcbiAgdGhyb3cgbmV3IEVycm9yKGAke2Vycm9yUHJlZml4fSAke3R5cGVvZiBCaWdJbnQgPT09IFwiZnVuY3Rpb25cIiA/IFwiVXNlIEJpZ0ludC5cIiA6IFwiUGFzcyBzdHJpbmcgdmFsdWUgaW5zdGVhZC5cIn0gYCk7XG59O1xuXG5jb25zdCBjb252ZXJ0VG9OdW1iZXJBdHRyID0gKG51bTogbnVtYmVyIHwgTnVtYmVyKTogeyBOOiBzdHJpbmcgfSA9PiB7XG4gIGlmIChcbiAgICBbTnVtYmVyLk5hTiwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFldXG4gICAgICAubWFwKCh2YWwpID0+IHZhbC50b1N0cmluZygpKVxuICAgICAgLmluY2x1ZGVzKG51bS50b1N0cmluZygpKVxuICApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFNwZWNpYWwgbnVtZXJpYyB2YWx1ZSAke251bS50b1N0cmluZygpfSBpcyBub3QgYWxsb3dlZGApO1xuICB9IGVsc2UgaWYgKG51bSA+IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKSB7XG4gICAgdmFsaWRhdGVCaWdJbnRBbmRUaHJvdyhgTnVtYmVyICR7bnVtLnRvU3RyaW5nKCl9IGlzIGdyZWF0ZXIgdGhhbiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUi5gKTtcbiAgfSBlbHNlIGlmIChudW0gPCBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikge1xuICAgIHZhbGlkYXRlQmlnSW50QW5kVGhyb3coYE51bWJlciAke251bS50b1N0cmluZygpfSBpcyBsZXNzZXIgdGhhbiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUi5gKTtcbiAgfVxuICByZXR1cm4geyBOOiBudW0udG9TdHJpbmcoKSB9O1xufTtcblxuY29uc3QgaXNCaW5hcnkgPSAoZGF0YTogYW55KTogYm9vbGVhbiA9PiB7XG4gIGNvbnN0IGJpbmFyeVR5cGVzID0gW1xuICAgIFwiQXJyYXlCdWZmZXJcIixcbiAgICBcIkJsb2JcIixcbiAgICBcIkJ1ZmZlclwiLFxuICAgIFwiRGF0YVZpZXdcIixcbiAgICBcIkZpbGVcIixcbiAgICBcIkludDhBcnJheVwiLFxuICAgIFwiVWludDhBcnJheVwiLFxuICAgIFwiVWludDhDbGFtcGVkQXJyYXlcIixcbiAgICBcIkludDE2QXJyYXlcIixcbiAgICBcIlVpbnQxNkFycmF5XCIsXG4gICAgXCJJbnQzMkFycmF5XCIsXG4gICAgXCJVaW50MzJBcnJheVwiLFxuICAgIFwiRmxvYXQzMkFycmF5XCIsXG4gICAgXCJGbG9hdDY0QXJyYXlcIixcbiAgICBcIkJpZ0ludDY0QXJyYXlcIixcbiAgICBcIkJpZ1VpbnQ2NEFycmF5XCIsXG4gIF07XG5cbiAgaWYgKGRhdGE/LmNvbnN0cnVjdG9yKSB7XG4gICAgcmV0dXJuIGJpbmFyeVR5cGVzLmluY2x1ZGVzKGRhdGEuY29uc3RydWN0b3IubmFtZSk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcbiJdfQ==